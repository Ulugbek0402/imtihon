<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction History | FinanceHome</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; font-family: 'Inter', sans-serif; }
        .sidebar { width: 260px; height: 100vh; position: fixed; background: #fff; border-right: 1px solid #eee; padding: 30px 20px; display: flex; flex-direction: column; z-index: 1000; }
        .main-content { margin-left: 260px; padding: 40px; }
        .nav-link { color: #666; padding: 12px; border-radius: 12px; margin-bottom: 5px; font-weight: 500; transition: 0.3s; }
        .nav-link:hover { background: #f1f3f5; color: #0d6efd; }
        .nav-link.active { background: #0d6efd !important; color: #fff !important; }
        .card-custom { border: none; border-radius: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); background: #fff; padding: 25px; }
        .badge-income { background-color: #d1e7dd; color: #0f5132; }
        .badge-expense { background-color: #f8d7da; color: #842029; }
    </style>
</head>
<body>

<div class="sidebar">
    <h4 class="fw-bold text-primary mb-5 px-2"><i class="bi bi-wallet2 me-2"></i>FinanceHome</h4>
    <ul class="nav flex-column mb-auto">
        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a></li>
        <li class="nav-item"><a class="nav-link active" href="{% url 'history' %}"><i class="bi bi-clock-history me-2"></i> Transactions</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'budget_list' %}"><i class="bi bi-pie-chart me-2"></i> Budgets</a></li>
    </ul>
    <div class="mt-auto">
        <a class="nav-link text-danger fw-bold border-top pt-3" href="{% url 'logout' %}"><i class="bi bi-box-arrow-right me-2"></i> Logout</a>
    </div>
</div>

<div class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-bold">Transaction History</h2>
            <p class="text-muted mb-0">List of all your financial movements</p>
        </div>

        <div class="dropdown">
            <button class="btn btn-white border shadow-sm rounded-pill px-4 dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-funnel me-1"></i> Filter Type
            </button>
            <ul class="dropdown-menu dropdown-menu-end border-0 shadow-sm rounded-4 p-2">
                <li><a class="dropdown-item rounded-3" href="?type=">All Transactions</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-success rounded-3" href="?type=INCOME">Incomes Only</a></li>
                <li><a class="dropdown-item text-danger rounded-3" href="?type=EXPENSE">Expenses Only</a></li>
            </ul>
        </div>
    </div>

    <div class="card card-custom">
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr class="small text-muted">
                        <th class="ps-3">DATE</th>
                        <th>ACCOUNT</th>
                        <th>CATEGORY</th>
                        <th>TYPE</th>
                        <th class="text-end pe-3">AMOUNT</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transactions %}
                    <tr>
                        <td class="ps-3">
                            <div class="small fw-bold">{{ t.date|date:"d M, Y" }}</div>
                            <div class="text-muted small" style="font-size: 11px;">{{ t.date|date:"H:i" }}</div>
                        </td>
                        <td><div class="fw-bold">{{ t.account.name }}</div></td>
                        <td>
                            <span class="text-dark">{{ t.category }}</span>
                            {% if t.type == 'EXPENSE' %}
                                <i class="bi bi-pie-chart ms-1 text-warning" title="Affects Budget"></i>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge rounded-pill {% if t.type == 'INCOME' %}badge-income{% else %}badge-expense{% endif %} px-3 py-2">
                                {{ t.type }}
                            </span>
                        </td>
                        <td class="text-end pe-3 fw-bold {% if t.type == 'INCOME' %}text-success{% else %}text-danger{% endif %}" style="font-size: 1.1rem;">
                            {% if t.type == 'INCOME' %}+{% else %}-{% endif %}
                            {{ t.amount|floatformat:2 }} <span class="small">{{ t.account.currency.code }}</span>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-5 text-muted">No transactions found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>